<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قائمة المهام - واجهة محسنة</title>
    <link rel="icon" href="https://img.icons8.com/ios-filled/64/4a90e2/checklist.svg" type="image/svg+xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #666;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: calc(var(--border-radius) - 5px);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: var(--secondary-color);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        /* Content Area */
        .content-area {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            min-height: 400px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Task Cards */
        .tasks-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .task-card {
            background: var(--white);
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }

        .task-card.completed {
            background: #f8fff8;
            border-color: var(--success-color);
        }

        .task-card.completed .task-title {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .task-id {
            background: var(--primary-color);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .task-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: #666;
        }

        .priority-badge, .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .priority-high { background: #ffe6e6; color: #d63384; }
        .priority-medium { background: #fff3cd; color: #856404; }
        .priority-low { background: #d1ecf1; color: #0c5460; }

        .status-completed { background: #d4edda; color: #155724; }
        .status-pending { background: #f8d7da; color: #721c24; }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #357abd;
            transform: translateY(-2px);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        /* Day Management */
        .day-management {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .day-timer {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            min-width: 200px;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .timer-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Archived Days */
        .archived-day {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .archived-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .archived-date {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .archived-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .nav-tab {
                min-width: auto;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .day-management {
                flex-direction: column;
                align-items: center;
            }
            
            .task-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .task-actions {
                flex-wrap: wrap;
            }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 25px;
            color: var(--white);
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.info { background: var(--info-color); }

        @keyframes slideIn {
            from {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>📋 قائمة المهام الذكية</h1>
            <p>إدارة مهامك اليومية بسهولة وبساطة</p>
        </div>

        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">إجمالي المهام</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingTasks">0</div>
                <div class="stat-label">مهام معلقة</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">مهام مكتملة</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayTasks">0</div>
                <div class="stat-label">مهام اليوم</div>
            </div>
        </div>

        <!-- Day Management -->
        <div class="day-management">
            <div class="day-timer">
                <div class="timer-display" id="dayTimer">12:00</div>
                <div class="timer-label">الوقت المتبقي لإنهاء اليوم</div>
            </div>
            <button class="btn btn-primary" onclick="endCurrentDay()">
                🌙 إنهاء اليوم الحالي
            </button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="all" onclick="switchTab('all')">
                📝 جميع المهام
            </button>
            <button class="nav-tab" data-tab="today" onclick="switchTab('today')">
                📅 مهام اليوم
            </button>
            <button class="nav-tab" data-tab="pending" onclick="switchTab('pending')">
                ⏳ المعلقة
            </button>
            <button class="nav-tab" data-tab="completed" onclick="switchTab('completed')">
                ✅ المكتملة
            </button>
            <button class="nav-tab" data-tab="high" onclick="switchTab('high')">
                🔥 عالية الأولوية
            </button>
            <button class="nav-tab" data-tab="archive" onclick="switchTab('archive')">
                📦 الأرشيف
            </button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- All Tasks Tab -->
            <div class="tab-content active" id="tab-all">
                <div class="tasks-grid" id="allTasksContainer">
                    <!-- المهام ستظهر هنا -->
                </div>
            </div>

            <!-- Today Tasks Tab -->
            <div class="tab-content" id="tab-today">
                <div class="tasks-grid" id="todayTasksContainer">
                    <!-- مهام اليوم ستظهر هنا -->
                </div>
            </div>

            <!-- Pending Tasks Tab -->
            <div class="tab-content" id="tab-pending">
                <div class="tasks-grid" id="pendingTasksContainer">
                    <!-- المهام المعلقة ستظهر هنا -->
                </div>
            </div>

            <!-- Completed Tasks Tab -->
            <div class="tab-content" id="tab-completed">
                <div class="tasks-grid" id="completedTasksContainer">
                    <!-- المهام المكتملة ستظهر هنا -->
                </div>
            </div>

            <!-- High Priority Tasks Tab -->
            <div class="tab-content" id="tab-high">
                <div class="tasks-grid" id="highTasksContainer">
                    <!-- المهام عالية الأولوية ستظهر هنا -->
                </div>
            </div>

            <!-- Archive Tab -->
            <div class="tab-content" id="tab-archive">
                <div id="archiveContainer">
                    <!-- الأرشيف سيظهر هنا -->
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loadingState" style="display: none;">
                <div class="loading-spinner"></div>
                <p>جاري تحميل المهام...</p>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let tasks = [];
        let archivedDays = [];
        let currentTab = 'all';
        let dayStartTime = new Date();
        let dayTimer = null;

        // Initialize App
        window.addEventListener('load', () => {
            loadTasks();
            startDayTimer();
        });

        // Load Tasks
        async function loadTasks() {
            showLoading(true);
            
            try {
                const response = await fetch('tasks.json');
                
                if (response.ok) {
                    const data = await response.json();
                    tasks = data.tasks || [];
                    archivedDays = data.archivedDays || [];
                    dayStartTime = data.dayStartTime ? new Date(data.dayStartTime) : new Date();
                } else {
                    // Use sample data if file doesn't exist
                    tasks = generateSampleTasks();
                    archivedDays = generateSampleArchive();
                }
                
                updateStats();
                displayCurrentTab();
            } catch (error) {
                console.log('Using sample data');
                tasks = generateSampleTasks();
                archivedDays = generateSampleArchive();
                updateStats();
                displayCurrentTab();
            } finally {
                showLoading(false);
            }
        }

        // Generate Sample Tasks
        function generateSampleTasks() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            return [
                {
                    id: 1,
                    title: "تحضير التقرير الشهري",
                    description: "إعداد تقرير شامل عن أداء الشركة في الشهر الماضي",
                    priority: "عالي",
                    status: "معلق",
                    completed: false,
                    createdAt: today.toISOString(),
                    userId: 123456789,
                    username: "ahmed_user"
                },
                {
                    id: 2,
                    title: "شراء البقالة",
                    description: "شراء الأساسيات من السوبر ماركت",
                    priority: "متوسط",
                    status: "مكتمل",
                    completed: true,
                    createdAt: yesterday.toISOString(),
                    completedAt: today.toISOString(),
                    userId: 123456789,
                    username: "sara_user"
                },
                {
                    id: 3,
                    title: "مراجعة الإيميلات",
                    description: "مراجعة والرد على جميع الإيميلات المهمة",
                    priority: "متوسط",
                    status: "معلق",
                    completed: false,
                    createdAt: today.toISOString(),
                    userId: 123456789,
                    username: "mohammed_user"
                },
                {
                    id: 4,
                    title: "تحديث الموقع الإلكتروني",
                    description: "إضافة المحتوى الجديد وتحديث التصميم",
                    priority: "عالي",
                    status: "مكتمل",
                    completed: true,
                    createdAt: today.toISOString(),
                    completedAt: today.toISOString(),
                    userId: 123456789,
                    username: "fatima_user"
                }
            ];
        }

        // Generate Sample Archive
        function generateSampleArchive() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            return [
                {
                    date: yesterday.toISOString(),
                    endDate: yesterday.toISOString(),
                    tasks: [
                        {
                            id: 100,
                            title: "اجتماع الفريق الأسبوعي",
                            description: "مناقشة خطة العمل للأسبوع القادم",
                            priority: "متوسط",
                            status: "مكتمل",
                            completed: true,
                            createdAt: yesterday.toISOString(),
                            completedAt: yesterday.toISOString(),
                            userId: 123456789,
                            username: "team_lead"
                        }
                    ]
                }
            ];
        }

        // Update Statistics
        function updateStats() {
            const total = tasks.length;
            const pending = tasks.filter(task => !task.completed).length;
            const completed = tasks.filter(task => task.completed).length;
            const today = tasks.filter(task => isToday(task.createdAt)).length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('pendingTasks').textContent = pending;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('todayTasks').textContent = today;
        }

        // Check if date is today
        function isToday(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        // Switch Tab
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Display content
            displayCurrentTab();
        }

        // Display Current Tab
        function displayCurrentTab() {
            switch(currentTab) {
                case 'all':
                    displayTasks(tasks, 'allTasksContainer');
                    break;
                case 'today':
                    displayTasks(tasks.filter(task => isToday(task.createdAt)), 'todayTasksContainer');
                    break;
                case 'pending':
                    displayTasks(tasks.filter(task => !task.completed), 'pendingTasksContainer');
                    break;
                case 'completed':
                    displayTasks(tasks.filter(task => task.completed), 'completedTasksContainer');
                    break;
                case 'high':
                    displayTasks(tasks.filter(task => task.priority === 'عالي'), 'highTasksContainer');
                    break;
                case 'archive':
                    displayArchive();
                    break;
            }
        }

        // Display Tasks
        function displayTasks(taskList, containerId) {
            const container = document.getElementById(containerId);
            
            if (taskList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📝</div>
                        <h3>لا توجد مهام</h3>
                        <p>لا توجد مهام في هذا التصنيف حالياً</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = taskList.map(task => createTaskCard(task)).join('');
        }

        // Create Task Card
        function createTaskCard(task) {
            const priorityClass = `priority-${task.priority === 'عالي' ? 'high' : task.priority === 'متوسط' ? 'medium' : 'low'}`;
            const statusClass = task.completed ? 'completed' : '';
            const statusIcon = task.completed ? '✅' : '⏳';
            const priorityIcon = {
                'عالي': '🔥',
                'متوسط': '📋',
                'منخفض': '📝'
            }[task.priority] || '📋';

            return `
                <div class="task-card ${statusClass}">
                    <div class="task-header">
                        <div>
                            <div class="task-title">${statusIcon} ${task.title}</div>
                            ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                        </div>
                        <div class="task-id">#${task.id}</div>
                    </div>
                    
                    <div class="task-meta">
                        <div class="meta-item">
                            <span>${priorityIcon}</span>
                            <span class="priority-badge ${priorityClass}">
                                ${task.priority}
                            </span>
                        </div>
                        
                        <div class="meta-item">
                            <span>📊</span>
                            <span class="status-badge status-${task.completed ? 'completed' : 'pending'}">
                                ${task.status}
                            </span>
                        </div>
                        
                        <div class="meta-item">
                            <span>👤</span>
                            <span>@${task.username}</span>
                        </div>
                        
                        <div class="meta-item">
                            <span>📅</span>
                            <span>${formatDate(task.createdAt)}</span>
                        </div>
                        
                        ${task.completedAt ? `
                            <div class="meta-item">
                                <span>✅</span>
                                <span>اكتمل: ${formatDate(task.completedAt)}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="task-actions">
                        ${!task.completed ? `
                            <button class="btn btn-success" onclick="completeTask(${task.id})">
                                ✅ إكمال
                            </button>
                        ` : ''}
                        <button class="btn btn-danger" onclick="deleteTask(${task.id})">
                            🗑️ حذف
                        </button>
                    </div>
                </div>
            `;
        }

        // Display Archive
        function displayArchive() {
            const container = document.getElementById('archiveContainer');
            
            if (archivedDays.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📦</div>
                        <h3>لا توجد أيام مؤرشفة</h3>
                        <p>ستظهر هنا الأيام التي تم إنهاؤها</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = archivedDays.map(day => createArchivedDayCard(day)).join('');
        }

        // Create Archived Day Card
        function createArchivedDayCard(day) {
            const dayDate = new Date(day.date);
            const totalTasks = day.tasks.length;
            const completedTasks = day.tasks.filter(task => task.completed).length;
            const pendingTasks = totalTasks - completedTasks;
            
            return `
                <div class="archived-day">
                    <div class="archived-day-header">
                        <div class="archived-date">
                            📅 ${formatDate(dayDate)}
                        </div>
                        <div class="archived-stats">
                            <span>📝 ${totalTasks} مهمة</span>
                            <span>✅ ${completedTasks} مكتملة</span>
                            <span>⏳ ${pendingTasks} معلقة</span>
                        </div>
                    </div>
                    <div class="tasks-grid">
                        ${day.tasks.map(task => createTaskCard(task)).join('')}
                    </div>
                </div>
            `;
        }

       // Complete Task
        async function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = true;
                task.status = 'مكتمل';
                task.completedAt = new Date().toISOString();
                
                updateStats();
                displayCurrentTab();
                showNotification('تم إكمال المهمة بنجاح!', 'success');
            }
        }

        // Delete Task
        async function deleteTask(taskId) {
            if (confirm('هل أنت متأكد من حذف هذه المهمة؟')) {
                tasks = tasks.filter(t => t.id !== taskId);
                updateStats();
                displayCurrentTab();
                showNotification('تم حذف المهمة بنجاح!', 'success');
            }
        }

        // End Current Day
        function endCurrentDay() {
            if (confirm('هل تريد إنهاء اليوم الحالي وأرشفة جميع المهام؟')) {
                const currentDate = new Date();
                
                // Create archived day
                const archivedDay = {
                    date: dayStartTime.toISOString(),
                    endDate: currentDate.toISOString(),
                    tasks: [...tasks]
                };
                
                archivedDays.unshift(archivedDay);
                
                // Reset for new day
                tasks = [];
                dayStartTime = new Date();
                
                updateStats();
                displayCurrentTab();
                startDayTimer();
                showNotification('تم إنهاء اليوم وأرشفة المهام بنجاح!', 'success');
            }
        }

        // Start Day Timer
        function startDayTimer() {
            clearInterval(dayTimer);
            
            dayTimer = setInterval(() => {
                const now = new Date();
                const endOfDay = new Date(dayStartTime);
                endOfDay.setHours(23, 59, 59, 999);
                
                const remaining = endOfDay - now;
                
                if (remaining <= 0) {
                    document.getElementById('dayTimer').textContent = '00:00';
                    clearInterval(dayTimer);
                    return;
                }
                
                const hours = Math.floor(remaining / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                
                document.getElementById('dayTimer').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Format Date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('ar-SA', options);
        }

        // Show Notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Show/Hide Loading
        function showLoading(show) {
            const loadingElement = document.getElementById('loadingState');
            const contentElements = document.querySelectorAll('.tab-content:not(#loadingState)');
            
            if (show) {
                loadingElement.style.display = 'block';
                contentElements.forEach(el => el.style.display = 'none');
            } else {
                loadingElement.style.display = 'none';
                contentElements.forEach(el => el.style.display = '');
                displayCurrentTab();
            }
        }

        // Add New Task (can be called externally)
        function addTask(title, description, priority = 'متوسط') {
            const newTask = {
                id: Math.max(...tasks.map(t => t.id), 0) + 1,
                title: title,
                description: description,
                priority: priority,
                status: 'معلق',
                completed: false,
                createdAt: new Date().toISOString(),
                userId: 123456789,
                username: 'current_user'
            };
            
            tasks.push(newTask);
            updateStats();
            displayCurrentTab();
            showNotification('تم إضافة المهمة بنجاح!', 'success');
            
            return newTask;
        }

        // Search Tasks
        function searchTasks(query) {
            const filtered = tasks.filter(task => 
                task.title.toLowerCase().includes(query.toLowerCase()) ||
                task.description.toLowerCase().includes(query.toLowerCase())
            );
            return filtered;
        }

        // Export Data
        function exportData() {
            const data = {
                tasks: tasks,
                archivedDays: archivedDays,
                dayStartTime: dayStartTime.toISOString(),
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tasks-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        switchTab('all');
                        break;
                    case '2':
                        e.preventDefault();
                        switchTab('today');
                        break;
                    case '3':
                        e.preventDefault();
                        switchTab('pending');
                        break;
                    case '4':
                        e.preventDefault();
                        switchTab('completed');
                        break;
                    case '5':
                        e.preventDefault();
                        switchTab('high');
                        break;
                    case '6':
                        e.preventDefault();
                        switchTab('archive');
                        break;
                }
            }
        });

        // Auto-save functionality (if needed)
        setInterval(() => {
            // This would save to localStorage or send to server
            // localStorage.setItem('todoAppData', JSON.stringify({
            //     tasks: tasks,
            //     archivedDays: archivedDays,
            //     dayStartTime: dayStartTime
            // }));
        }, 30000); // Auto-save every 30 seconds

    </script>
</body>
</html>